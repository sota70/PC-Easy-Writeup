# PC(Easy)
今回はHackTheBoxのPCマシーンを解いたので、その流れを解説します。
<br>
<br>
## 情報収集
まずはポートスキャンを行い、アクセスできるサービスがないかを探します。
![portscan](https://github.com/sota70/PC-Easy-Writeup/assets/46929379/01c3fb71-aa95-4030-a776-2752a469d81d)
そうすると、22番ポート(SSH)と50051番ポートが開いているのか分かります。
50051番ポートはgRPCという、Proto RequestとProto Responseの２つのメッセージで通信を行う
プロトコルのデフォルトポートです。
<br>
<br>
### gRPCへアクセス
gRPCが怪しいので、gRPCUIというツール(<https://github.com/fullstorydev/grpcui>)を使って
中身を見てみます。
そうすると、gRPCプロトコル経由でアカウントの登録、ログイン、アカウント情報取得ができることが分かります。
ここでは、既にadminアカウントがadminというパスワードで登録されていました。
sqlmapを使いアカウント登録、ログイン、アカウント情報取得のどれかでsql injectionできないか試してみます。
そうすると、アカウント情報取得だけsql injectionの脆弱性があることが分かりました。
<br>
<br>
## 侵入
このアカウント情報取得ページからテーブルの内容をsql injectionを使って表示できそうなので
実際にやってみます。
そうすると、sauというアカウント情報がパスワードとともに出てきました。このアカウントでSSH接続できそうなので、やってみます。
sauのアカウントでSSH接続することができました。
ちなみに、ログインするとuser.txtというファイルがあり、その中に1つ目のフラグが入っていました。
<br>
<br>
## 情報収集2
まず、suidがついた実行ファイルが無いか確認します。PATH変数を利用した権限昇格ができないか試すためです。
ですが、利用できるファイルが見つからなかったので、次はローカルで動いてるサービスが無いか確認してみます。
そうすると、pyLoadというサービスが見つかりました。pyLoadはさらに、rootでサービスを動かしていました。
これは権限昇格に使えそうです。このサービス内で利用できそうな脆弱性を探してみると
command injectionの脆弱性が見つかりました(<https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad>)
<br>
<br>
## 攻撃スクリプトの作成
pyLoadの脆弱性を利用した攻撃では、reverse-shellを使います。今回は２つのスクリプトを作ります。
1つ目のスクリプトはpyLoadに/tmp/exploit.shを実行させるスクリプトです。
２つ目のスクリプトは自分のPCで動かしているC2サーバーにアクセスさせるスクリプトです。
今回はC2サーバーにVillain(<https://github.com/t3l3machus/Villain>)を使っています。
<br>
<br>
## 侵入2
実際に作成したスクリプトを実行してみましょう。
そうすると無事セッションが確立できました。
rootディレクトリに行ってみると２個目のフラグがあったので、これでPCは終わりです。
